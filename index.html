<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’³ App de PrÃ©stamos</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { background: #f1f5f9; font-family: 'Inter', sans-serif; }
.card { transition: transform .2s; }
.card:hover { transform: translateY(-4px); }
.slide-in { animation: slide .25s ease-in-out; }
@keyframes slide { from {opacity:0;transform:translateX(-20px)} to {opacity:1;transform:translateX(0)} }
#sidebar { transition: transform .3s ease-in-out; }
#sidebar.hidden { transform: translateX(-100%); }
</style>
</head>
<body class="overflow-x-hidden">

<!-- HEADER -->
<header class="bg-blue-600 text-white p-4 flex items-center justify-between">
  <button id="menuBtn" class="text-2xl">â˜°</button>
  <h1 class="text-xl font-bold">PrÃ©stamos App</h1>
  <span id="currentUserName" class="text-sm opacity-80">Invitado</span>
</header>

<!-- SIDEBAR -->
<aside id="sidebar" class="hidden fixed inset-y-0 left-0 bg-white shadow-xl w-64 z-50 slide-in">
  <div class="p-4 border-b">
    <h2 class="font-bold text-lg text-blue-600">MenÃº</h2>
  </div>
  <nav class="p-4 space-y-3 text-gray-700">
    <button onclick="navigate('inicio')" class="w-full text-left hover:text-blue-600">ğŸ  Inicio</button>
    <button onclick="navigate('prestamos')" class="w-full text-left hover:text-blue-600">ğŸ’° PrÃ©stamos</button>
    <button onclick="navigate('historial')" class="w-full text-left hover:text-blue-600">ğŸ“œ Historial</button>
    <button onclick="navigate('config')" class="w-full text-left hover:text-blue-600">âš™ï¸ ConfiguraciÃ³n</button>
  </nav>
  <div class="absolute bottom-0 w-full p-4 border-t text-sm text-gray-500">v1.1.0 Â© 2025</div>
</aside>

<!-- OVERLAY -->
<div id="overlay" class="hidden fixed inset-0 bg-black bg-opacity-40 z-40"></div>

<!-- CONTENIDO PRINCIPAL -->
<main id="content" class="p-4 mt-2 space-y-4"></main>

<!-- MODAL PAGO -->
<div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-2xl w-80 shadow-xl slide-in">
    <h2 class="text-xl font-bold text-center mb-3 text-blue-700">Registrar pago</h2>
    <p id="modalClient" class="text-center text-gray-600 mb-3"></p>
    <form id="paymentForm" class="space-y-3">
      <input type="number" id="paymentAmount" placeholder="Monto" class="border rounded-lg w-full p-2 text-center focus:ring focus:ring-blue-300" required />
      <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white w-full py-2 rounded-lg font-semibold">ğŸ’° Guardar pago</button>
    </form>
    <button id="cancelBtn" class="mt-3 text-sm text-gray-500 w-full hover:text-gray-700">Cancelar</button>
  </div>
</div>

<script>
// ================== DATOS DE PRUEBA ==================
const users = [
  { email: "admin@empresa.com", name: "Admin", routes: ["Ruta 1","Ruta 2","Ruta 3"] },
  { email: "juan@empresa.com", name: "Juan PÃ©rez", routes: ["Ruta 1"] },
  { email: "maria@empresa.com", name: "MarÃ­a GÃ³mez", routes: ["Ruta 2","Ruta 3"] }
];

let currentUser = users[0];

const loans = [
  { id:1, client:"Carlos GÃ³mez", route:"Ruta 1", amount:1000, balance:700, payments:[{date:"2025-11-01",amount:100},{date:"2025-11-05",amount:200}] },
  { id:2, client:"Ana PÃ©rez", route:"Ruta 2", amount:800, balance:300, payments:[{date:"2025-11-03",amount:250}] },
  { id:3, client:"Luis DÃ­az", route:"Ruta 3", amount:1200, balance:800, payments:[] },
  { id:4, client:"Pedro Torres", route:"Ruta 1", amount:600, balance:200, payments:[{date:"2025-11-06",amount:100}] },
];

// ================== ELEMENTOS ==================
const sidebar = document.getElementById("sidebar");
const overlay = document.getElementById("overlay");
const menuBtn = document.getElementById("menuBtn");
const content = document.getElementById("content");
const modal = document.getElementById("modal");
const modalClient = document.getElementById("modalClient");
const paymentForm = document.getElementById("paymentForm");
const paymentAmount = document.getElementById("paymentAmount");
const cancelBtn = document.getElementById("cancelBtn");
const userLabel = document.getElementById("currentUserName");

let currentLoan = null;

// ================== MENÃš ==================
menuBtn.onclick = () => toggleMenu();
overlay.onclick = () => toggleMenu();
function toggleMenu(){ sidebar.classList.toggle("hidden"); overlay.classList.toggle("hidden"); }

// ================== NAVEGACIÃ“N ==================
function navigate(section){
  toggleMenu();
  if(section==="inicio") renderInicio();
  if(section==="prestamos") renderPrestamos();
  if(section==="historial") renderHistorial();
  if(section==="config") renderConfig();
}

// ================== LOGIN SIMULADO ==================
function renderInicio(){
  content.innerHTML = `
  <div class="bg-white p-4 rounded-xl shadow">
    <h2 class="text-xl font-bold text-blue-700 mb-2">ğŸ‘¤ Seleccionar usuario</h2>
    <select id="userSelect" class="border rounded p-2 w-full">
      ${users.map(u=>`<option value="${u.email}">${u.name}</option>`).join("")}
    </select>
  </div>
  <div class="bg-white p-4 rounded-xl shadow mt-4">
    <h2 class="text-xl font-bold text-blue-700 mb-3">ğŸ“Š Resumen General</h2>
    <p>Selecciona un usuario para ver sus rutas y prÃ©stamos.</p>
  </div>
  `;
  document.getElementById("userSelect").onchange = (e)=>{
    const email = e.target.value;
    currentUser = users.find(u=>u.email===email);
    userLabel.innerText = currentUser.name;
    renderPrestamos();
  };
}

// ================== PANTALLA PRÃ‰STAMOS ==================
function renderPrestamos(){
  const filtered = loans.filter(l => currentUser.routes.includes(l.route));
  content.innerHTML = `
    <h2 class="text-xl font-bold text-blue-700 mb-3">ğŸ’° PrÃ©stamos de ${currentUser.name}</h2>
    ${
      filtered.map(l=>`
        <div class="card bg-white p-4 rounded-xl shadow mb-3">
          <div class="flex justify-between mb-2">
            <h4 class="font-semibold">${l.client}</h4>
            <span class="text-sm text-gray-500">${l.route}</span>
          </div>
          <p>Monto: <b>$${l.amount}</b></p>
          <p>Saldo: <b class="text-blue-600">$${l.balance}</b></p>
          <div class="mt-2 flex gap-2">
            <button class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm" onclick="openModal(${l.id})">ğŸ’µ Pago</button>
            <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm" onclick="toggleHistory(${l.id})">ğŸ“œ Historial</button>
          </div>
          <div id="history-${l.id}" class="hidden mt-3 border-t pt-2 text-sm">
            ${
              l.payments.length===0
              ? `<p class="text-gray-400 italic">Sin pagos</p>`
              : l.payments.map(p=>`<div class="flex justify-between"><span>${p.date}</span><span>$${p.amount}</span></div>`).join("")
            }
          </div>
        </div>
      `).join("") || `<p class="text-gray-400 italic">No hay prÃ©stamos en tus rutas asignadas.</p>`
    }
  `;
}

// ================== HISTORIAL ==================
function renderHistorial(){
  const allPayments = loans
    .filter(l => currentUser.routes.includes(l.route))
    .flatMap(l => l.payments.map(p => ({client:l.client,route:l.route,...p})));
  content.innerHTML = `
    <h2 class="text-xl font-bold text-blue-700 mb-3">ğŸ“œ Historial de Pagos</h2>
    ${
      allPayments.length===0
      ? `<p class="text-gray-400 italic">Sin pagos registrados</p>`
      : allPayments.map(p=>`
        <div class="bg-white p-3 rounded-xl shadow mb-2 flex justify-between">
          <span>${p.client} (${p.route})</span>
          <span class="text-blue-600">$${p.amount}</span>
        </div>
      `).join("")
    }
  `;
}

// ================== CONFIGURACIÃ“N ==================
function renderConfig(){
  content.innerHTML = `
    <h2 class="text-xl font-bold text-blue-700 mb-3">âš™ï¸ ConfiguraciÃ³n</h2>
    <div class="bg-white p-4 rounded-xl shadow">
      <p><b>Usuario:</b> ${currentUser.name}</p>
      <p><b>Email:</b> ${currentUser.email}</p>
      <p><b>Rutas:</b> ${currentUser.routes.join(", ")}</p>
      <button class="bg-red-500 hover:bg-red-600 text-white w-full mt-4 py-2 rounded" onclick="renderInicio()">Cerrar sesiÃ³n</button>
    </div>
  `;
}

// ================== FUNCIONES DE PAGO ==================
function toggleHistory(id){ document.getElementById(`history-${id}`).classList.toggle("hidden"); }
function openModal(id){
  currentLoan = loans.find(l=>l.id===id);
  modalClient.innerText = currentLoan.client;
  modal.classList.remove("hidden");
}
cancelBtn.onclick = closeModal;
function closeModal(){ modal.classList.add("hidden"); paymentAmount.value=""; }
paymentForm.onsubmit = (e)=>{
  e.preventDefault();
  const amount = Number(paymentAmount.value);
  if(amount>0 && currentLoan){
    const today = new Date().toISOString().split("T")[0];
    currentLoan.payments.push({date:today,amount});
    currentLoan.balance -= amount;
    alert("âœ… Pago registrado con Ã©xito");
    closeModal(); renderPrestamos();
  }
};

// ================== INICIAL ==================
renderInicio();
</script>
</body>
</html>
